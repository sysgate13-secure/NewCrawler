<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì•ˆ ë‰´ìŠ¤ í¬ë¡¤ë§ & ì§€ì‹ ê³µìœ  í”Œë«í¼</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='favicon.ico') }}">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">ğŸ”’ ë³´ì•ˆ ë‰´ìŠ¤ í”Œë«í¼</div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="news">ë‰´ìŠ¤</a></li>
                    <li><a href="#" class="nav-link" data-section="wiki">ì§€ì‹ ì‚¬ì „</a></li>
                    <li><a href="#" class="nav-link" data-section="dashboard">ëŒ€ì‹œë³´ë“œ</a></li>
                    <li><a href="/wiki/manage">ğŸ“ ìœ„í‚¤ ê´€ë¦¬</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-container">
        <main class="content-area">
            <div id="news-section" class="news-content">
                <div class="section-header">
                    <h1 class="section-title">ìµœì‹  ë³´ì•ˆ ë‰´ìŠ¤</h1>
                    <button class="crawl-btn" onclick="runCrawler()">ğŸ”„ í¬ë¡¤ë§</button>
                </div>
                
                <!-- ê²€ìƒ‰ ë° í•„í„° -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <div class="search-filter-grid" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem;">
                        <input type="text" id="newsSearch" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰..." class="search-input" onkeyup="searchNews()">
                        <select id="newsCategory" class="search-input" onchange="searchNews()">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="trend">íŠ¸ë Œë“œ</option>
                            <option value="malware">ì•…ì„±ì½”ë“œ</option>
                            <option value="vulnerability">ì·¨ì•½ì </option>
                            <option value="network">ë„¤íŠ¸ì›Œí¬</option>
                            <option value="web">ì›¹ ë³´ì•ˆ</option>
                            <option value="crypto">ì•”í˜¸í•™</option>
                        </select>
                        <button class="filter-btn active" onclick="loadNews()">ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <!-- Pagination Controls -->
                <div id="pagination-controls" class="pagination-controls">
                    <div>
                        <label for="pageSize" style="font-size: 0.9rem; margin-right: 0.5rem;">í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜:</label>
                        <select id="pageSize" onchange="changeLimit(this.value)" class="search-input" style="width: auto;">
                            <option value="10" {% if pagination.limit == 10 %}selected{% endif %}>10</option>
                            <option value="20" {% if pagination.limit == 20 %}selected{% endif %}>20</option>
                            <option value="50" {% if pagination.limit == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if pagination.limit == 100 %}selected{% endif %}>100</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button id="prevPage" class="filter-btn" onclick="changePage('prev')" {% if pagination.page <= 1 %}disabled{% endif %}>ì´ì „</button>
                        <span id="pageInfo">í˜ì´ì§€ {{ pagination.page }} / {{ pagination.total_pages }}</span>
                        <button id="nextPage" class="filter-btn" onclick="changePage('next')" {% if pagination.page >= pagination.total_pages %}disabled{% endif %}>ë‹¤ìŒ</button>
                    </div>
                    <div style="font-size: 0.9rem; color: #555;">
                        ì´ <strong id="totalItems">{{ pagination.total_items }}</strong>ê°œ
                    </div>
                </div>
                
                {% set category_labels = {'malware':'ì•…ì„±ì½”ë“œ','vulnerability':'ì·¨ì•½ì ','network':'ë„¤íŠ¸ì›Œí¬','web':'ì›¹ ë³´ì•ˆ','crypto':'ì•”í˜¸í•™','trend':'ê¸°íƒ€'} %}
                <div class="news-grid" id="newsGrid">
                    {% for news in news_list %}
                    <div class="news-item">
                        <div class="news-meta">
                            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                                <span class="news-category">{{ category_labels.get(news.category, news.category) }}</span>
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <span class="news-source" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                    ğŸ‡°ğŸ‡· {{ news.source }}
                                </span>
                                {% else %}
                                <span class="news-source" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                                    ğŸŒ {{ news.source }}
                                </span>
                                {% endif %}
                            </div>
                            <span style="color: #999; font-size: 0.85rem;">{{ news.date }}</span>
                        </div>
                        <h3 class="news-title">
                            <a href="{{ news.url }}" target="_blank">{{ news.title }}</a>
                        </h3>
                        {% if news.summary %}
                        <p class="news-summary">{{ news.summary | clean_summary }}</p>
                        {% endif %}
                        <div style="margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 0.8rem; color: #6c757d;">
                                ğŸ“° ì¶œì²˜: 
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <a href="https://www.boannews.com" target="_blank" style="color: #667eea; text-decoration: none;">www.boannews.com</a>
                                {% elif 'HackRead' in news.source %}
                                <a href="https://www.hackread.com" target="_blank" style="color: #f093fb; text-decoration: none;">www.hackread.com</a>
                                {% else %}
                                <span>{{ news.source }}</span>
                                {% endif %}
                            </div>
                            <a href="{{ news.url }}" target="_blank" style="color: #667eea; text-decoration: none; font-size: 0.85rem; font-weight: 500;">
                                ì›ë¬¸ ë³´ê¸° â†’
                            </a>
                            <button class="delete-btn" onclick="deleteNews('{{ news.id }}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="wiki-section" class="wiki-content">
                <div class="section-header">
                    <h1 class="section-title">ë³´ì•ˆ ì§€ì‹ ì‚¬ì „</h1>
                </div>
                <div id="wikiGrid" class="wiki-grid">
                    {% for wiki in wiki_list %}
                    <div class="wiki-card" onclick="location.href='/wiki/{{ wiki.id }}'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div class="wiki-category">{{ wiki.category }}</div>
                            {% if wiki.type == 'auto' %}
                            <span style="background: #e3f2fd; color: #1976d2; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                ğŸ¤– ìë™ìˆ˜ì§‘
                            </span>
                            {% elif wiki.type == 'manual' %}
                            <span style="background: #f3e5f5; color: #7b1fa2; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                âœï¸ ìˆ˜ë™ì‘ì„±
                            </span>
                            {% else %}
                            <span style="background: #e8f5e9; color: #388e3c; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                ğŸ“š ì „ë¬¸ë¬¸ì„œ
                            </span>
                            {% endif %}
                        </div>
                        <h3 class="wiki-title">{{ wiki.title }}</h3>
                        <p class="wiki-preview">{{ wiki | wiki_preview('medium') }}</p>
                        {% if wiki.tags %}
                        <div style="margin:10px 0 0 0;">
                            {% for t in (wiki.tags.split(',') if wiki.tags else []) %}
                            <span style="display:inline-block;background:#eef2ff;color:#3730a3;padding:0.2rem 0.5rem;border-radius:8px;margin-right:6px;font-size:0.8rem;">#{{ t }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="dashboard-section" class="dashboard-content">
                <div class="section-header">
                    <h1 class="section-title">ëŒ€ì‹œë³´ë“œ</h1>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.news_count }}</div>
                        <div class="stat-label">ìˆ˜ì§‘ëœ ë‰´ìŠ¤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.wiki_count }}</div>
                        <div class="stat-label">ì§€ì‹ ë¬¸ì„œ</div>
                    </div>
                </div>

                <!-- í¬ë¡¤ë§ ì†ŒìŠ¤ ì •ë³´ -->
                <div class="dashboard-section-title">í¬ë¡¤ë§ ì†ŒìŠ¤</div>
                <div class="crawl-sources">
                    <div class="source-card">
                        <h4>ğŸ‡°ğŸ‡· êµ­ë‚´ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>ë³´ì•ˆë‰´ìŠ¤</strong> - www.boannews.com<br>
                                <small style="color: #999;">êµ­ë‚´ ìµœëŒ€ ì •ë³´ë³´ì•ˆ ì „ë¬¸ ë¯¸ë””ì–´</small>
                            </li>
                        </ul>
                    </div>
                    <div class="source-card">
                        <h4>ğŸŒ í•´ì™¸ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>HackRead</strong> - hackread.com<br>
                                <small style="color: #999;">ì‚¬ì´ë²„ ë³´ì•ˆ ë‰´ìŠ¤ ë° í•´í‚¹ ê´€ë ¨ ì •ë³´</small>
                            </li>
                        </ul>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: #856404;">
                        <strong>â„¹ï¸ í¬ë¡¤ë§ ì†ŒìŠ¤ ì •ë³´</strong><br>
                        í˜„ì¬ 2ê°œì˜ ì•ˆì •ì ì¸ ì†ŒìŠ¤ì—ì„œ ë‰´ìŠ¤ë¥¼ ìë™ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
                        ë§¤ì¼ ìë™ í¬ë¡¤ë§ ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ "í¬ë¡¤ë§" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë‰´ìŠ¤ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <!-- ì†ŒìŠ¤ë³„ í†µê³„ -->
                <div class="dashboard-section-title">ì†ŒìŠ¤ë³„ ë‰´ìŠ¤ ìˆ˜</div>
                <div id="source-stats" class="source-stats">
                    <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
                <div class="dashboard-section-title">ì¹´í…Œê³ ë¦¬ë³„ í†µê³„</div>
                <div class="category-stats-grid">
                    <div id="category-stats" class="category-stats">
                        <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ë‰´ìŠ¤ ë° ì§€ì‹ ê²€ìƒ‰..." onkeyup="searchContent(this.value)">
            </div>
            <div class="categories">
                <h3>ì¹´í…Œê³ ë¦¬</h3>
                <ul class="category-list">
                    <li onclick="filterByCategory('network')">ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('web')">ğŸ’» ì›¹ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('crypto')">ğŸ” ì•”í˜¸í•™</li>
                    <li onclick="filterByCategory('malware')">ğŸ¦  ì•…ì„±ì½”ë“œ</li>
                    <li onclick="filterByCategory('trend')">ğŸ“ˆ ìµœì‹  íŠ¸ë Œë“œ</li>
                </ul>
            </div>
        </aside>
    </div>

    <script src="{{ url_for('static', path='js/main.js') }}"></script>
</body>
</html>