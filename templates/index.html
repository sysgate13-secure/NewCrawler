<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì•ˆ ë‰´ìŠ¤ í¬ë¡¤ë§ & ì§€ì‹ ê³µìœ  í”Œë«í¼</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='favicon.ico') }}">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">ğŸ”’ ë³´ì•ˆ ë‰´ìŠ¤ í”Œë«í¼</div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="news">ë‰´ìŠ¤</a></li>
                    <li><a href="#" class="nav-link" data-section="wiki">ì§€ì‹ ì‚¬ì „</a></li>
                    <li><a href="#" class="nav-link" data-section="dashboard">ëŒ€ì‹œë³´ë“œ</a></li>
                    <li><a href="/wiki/manage">ğŸ“ ìœ„í‚¤ ê´€ë¦¬</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-container">
        <main class="content-area">
            <div id="news-section" class="news-content">
                <div class="section-header">
                    <h1 class="section-title">ìµœì‹  ë³´ì•ˆ ë‰´ìŠ¤</h1>
                    <button class="crawl-btn" onclick="runCrawler()">ğŸ”„ í¬ë¡¤ë§</button>
                </div>
                
                <!-- ê²€ìƒ‰ ë° í•„í„° -->
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <div class="search-filter-grid" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem;">
                        <input type="text" id="newsSearch" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰..." class="search-input" onkeyup="searchNews()">
                        <select id="newsCategory" class="search-input" onchange="searchNews()">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="trend">íŠ¸ë Œë“œ</option>
                            <option value="malware">ì•…ì„±ì½”ë“œ</option>
                            <option value="vulnerability">ì·¨ì•½ì </option>
                            <option value="network">ë„¤íŠ¸ì›Œí¬</option>
                            <option value="web">ì›¹ ë³´ì•ˆ</option>
                            <option value="crypto">ì•”í˜¸í•™</option>
                        </select>
                        <button class="filter-btn active" onclick="loadNews()">ì´ˆê¸°í™”</button>
                    </div>
                </div>
                
                {% set category_labels = {'malware':'ì•…ì„±ì½”ë“œ','vulnerability':'ì·¨ì•½ì ','network':'ë„¤íŠ¸ì›Œí¬','web':'ì›¹ ë³´ì•ˆ','crypto':'ì•”í˜¸í•™','trend':'ê¸°íƒ€'} %}
                <div class="news-grid" id="newsGrid">
                    {% for news in news_list %}
                    <div class="news-item">
                        <div class="news-meta">
                            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                                <span class="news-category">{{ category_labels.get(news.category, news.category) }}</span>
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <span class="news-source" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                    ğŸ‡°ğŸ‡· {{ news.source }}
                                </span>
                                {% else %}
                                <span class="news-source" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                                    ğŸŒ {{ news.source }}
                                </span>
                                {% endif %}
                            </div>
                            <span style="color: #999; font-size: 0.85rem;">{{ news.date }}</span>
                        </div>
                        <h3 class="news-title">
                            <a href="{{ news.url }}" target="_blank">{{ news.title }}</a>
                        </h3>
                        {% if news.summary %}
                        <p class="news-summary">{{ news.summary | clean_summary }}</p>
                        {% endif %}
                        <div style="margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 0.8rem; color: #6c757d;">
                                ğŸ“° ì¶œì²˜: 
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <a href="https://www.boannews.com" target="_blank" style="color: #667eea; text-decoration: none;">www.boannews.com</a>
                                {% elif 'HackRead' in news.source %}
                                <a href="https://www.hackread.com" target="_blank" style="color: #f093fb; text-decoration: none;">www.hackread.com</a>
                                {% else %}
                                <span>{{ news.source }}</span>
                                {% endif %}
                            </div>
                            <a href="{{ news.url }}" target="_blank" style="color: #667eea; text-decoration: none; font-size: 0.85rem; font-weight: 500;">
                                ì›ë¬¸ ë³´ê¸° â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="wiki-section" class="wiki-content">
                <div class="section-header">
                    <h1 class="section-title">ë³´ì•ˆ ì§€ì‹ ì‚¬ì „</h1>
                </div>
                <div id="wikiGrid" class="wiki-grid">
                    {% for wiki in wiki_list %}
                    <div class="wiki-card" onclick="location.href='/wiki/{{ wiki.id }}'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div class="wiki-category">{{ wiki.category }}</div>
                            {% if wiki.type == 'auto' %}
                            <span style="background: #e3f2fd; color: #1976d2; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                ğŸ¤– ìë™ìˆ˜ì§‘
                            </span>
                            {% elif wiki.type == 'manual' %}
                            <span style="background: #f3e5f5; color: #7b1fa2; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                âœï¸ ìˆ˜ë™ì‘ì„±
                            </span>
                            {% else %}
                            <span style="background: #e8f5e9; color: #388e3c; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600;">
                                ğŸ“š ì „ë¬¸ë¬¸ì„œ
                            </span>
                            {% endif %}
                        </div>
                        <h3 class="wiki-title">{{ wiki.title }}</h3>
                        <p class="wiki-preview">{{ wiki | wiki_preview('medium') }}</p>
                        {% if wiki.tags %}
                        <div style="margin:10px 0 0 0;">
                            {% for t in (wiki.tags.split(',') if wiki.tags else []) %}
                            <span style="display:inline-block;background:#eef2ff;color:#3730a3;padding:0.2rem 0.5rem;border-radius:8px;margin-right:6px;font-size:0.8rem;">#{{ t }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="dashboard-section" class="dashboard-content">
                <div class="section-header">
                    <h1 class="section-title">ëŒ€ì‹œë³´ë“œ</h1>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.news_count }}</div>
                        <div class="stat-label">ìˆ˜ì§‘ëœ ë‰´ìŠ¤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.wiki_count }}</div>
                        <div class="stat-label">ì§€ì‹ ë¬¸ì„œ</div>
                    </div>
                </div>

                <!-- í¬ë¡¤ë§ ì†ŒìŠ¤ ì •ë³´ -->
                <div class="dashboard-section-title">í¬ë¡¤ë§ ì†ŒìŠ¤</div>
                <div class="crawl-sources">
                    <div class="source-card">
                        <h4>ğŸ‡°ğŸ‡· êµ­ë‚´ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>ë³´ì•ˆë‰´ìŠ¤</strong> - www.boannews.com<br>
                                <small style="color: #999;">êµ­ë‚´ ìµœëŒ€ ì •ë³´ë³´ì•ˆ ì „ë¬¸ ë¯¸ë””ì–´</small>
                            </li>
                        </ul>
                    </div>
                    <div class="source-card">
                        <h4>ğŸŒ í•´ì™¸ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>HackRead</strong> - hackread.com<br>
                                <small style="color: #999;">ì‚¬ì´ë²„ ë³´ì•ˆ ë‰´ìŠ¤ ë° í•´í‚¹ ê´€ë ¨ ì •ë³´</small>
                            </li>
                        </ul>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: #856404;">
                        <strong>â„¹ï¸ í¬ë¡¤ë§ ì†ŒìŠ¤ ì •ë³´</strong><br>
                        í˜„ì¬ 2ê°œì˜ ì•ˆì •ì ì¸ ì†ŒìŠ¤ì—ì„œ ë‰´ìŠ¤ë¥¼ ìë™ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
                        ë§¤ì¼ ìë™ í¬ë¡¤ë§ ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ "í¬ë¡¤ë§" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë‰´ìŠ¤ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <!-- ì†ŒìŠ¤ë³„ í†µê³„ -->
                <div class="dashboard-section-title">ì†ŒìŠ¤ë³„ ë‰´ìŠ¤ ìˆ˜</div>
                <div id="source-stats" class="source-stats">
                    <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
                <div class="dashboard-section-title">ì¹´í…Œê³ ë¦¬ë³„ í†µê³„</div>
                <div class="category-stats-grid">
                    <div id="category-stats" class="category-stats">
                        <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="ë‰´ìŠ¤ ë° ì§€ì‹ ê²€ìƒ‰..." onkeyup="searchContent(this.value)">
            </div>
            <div class="categories">
                <h3>ì¹´í…Œê³ ë¦¬</h3>
                <ul class="category-list">
                    <li onclick="filterByCategory('network')">ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('web')">ğŸ’» ì›¹ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('crypto')">ğŸ” ì•”í˜¸í•™</li>
                    <li onclick="filterByCategory('malware')">ğŸ¦  ì•…ì„±ì½”ë“œ</li>
                    <li onclick="filterByCategory('trend')">ğŸ“ˆ ìµœì‹  íŠ¸ë Œë“œ</li>
                </ul>
            </div>
        </aside>
    </div>

    <script>
        let currentSection = 'news';

        const CATEGORY_LABELS = {
            'malware': 'ì•…ì„±ì½”ë“œ',
            'vulnerability': 'ì·¨ì•½ì ',
            'network': 'ë„¤íŠ¸ì›Œí¬',
            'web': 'ì›¹ ë³´ì•ˆ',
            'crypto': 'ì•”í˜¸í•™',
            'trend': 'ê¸°íƒ€'
        };

        const CATEGORY_EMOJI = {
            'malware': 'ğŸ¦ ',
            'vulnerability': 'ğŸ”“',
            'network': 'ğŸŒ',
            'web': 'ğŸ’»',
            'crypto': 'ğŸ”',
            'trend': 'ğŸ“ˆ'
        };

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const section = this.dataset.section;
                switchSection(section);
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function switchSection(section) {
            document.getElementById('news-section').style.display = 'none';
            document.getElementById('wiki-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById(section + '-section').style.display = 'block';
            currentSection = section;
            
            // ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ ì „í™˜ ì‹œ ë°ì´í„° ë¡œë“œ
            if (section === 'dashboard') {
                loadCrawlStatus();
                loadCrawlHistory();
                loadCategoryStats();
            }
        }

        function filterNews(filter) {
            location.reload();
        }

        function filterByCategory(category) {
            // ì‚¬ì´ë“œë°” ì¹´í…Œê³ ë¦¬ëŠ” ë‰´ìŠ¤ í•„í„°ì—ë§Œ ì ìš© (ì§€ì‹ì‚¬ì „ì€ ë³„ë„ ê´€ë¦¬)
            document.getElementById('newsCategory').value = category;
            document.getElementById('newsSearch').value = '';
            // ìë™ìœ¼ë¡œ ë‰´ìŠ¤ ì„¹ì…˜ í‘œì‹œ
            if (currentSection !== 'news') switchSection('news');
            searchNews();
        }

        async function searchContent(query) {
            // ìƒë‹¨ í†µí•© ê²€ìƒ‰: í˜„ì¬ ì„ íƒëœ ì„¹ì…˜ì„ ê¸°ì¤€ìœ¼ë¡œ API í˜¸ì¶œ
            if (!query || query.trim().length === 0) {
                // ë¹ˆ ì¿¼ë¦¬ëŠ” ê° ì„¹ì…˜ì˜ ê¸°ë³¸ ë¡œë“œë¡œ ë¦¬ì…‹
                if (currentSection === 'news') loadNews();
                if (currentSection === 'wiki') loadWiki();
                return;
            }

            if (currentSection === 'news') {
                document.getElementById('newsSearch').value = query;
                document.getElementById('newsCategory').value = '';
                searchNews();
                return;
            }

            if (currentSection === 'wiki') {
                // wiki APIë¡œ ê²€ìƒ‰
                try {
                    const url = `/api/wiki/search?q=${encodeURIComponent(query)}`;
                    const resp = await fetch(url);
                    const wikis = await resp.json();
                    renderWikiResults(wikis);
                } catch (e) {
                    console.error('ìœ„í‚¤ ê²€ìƒ‰ ì˜¤ë¥˜:', e);
                }
                return;
            }

            // ê¸°ë³¸: ë‰´ìŠ¤+ìœ„í‚¤ ëª¨ë‘ ê²€ìƒ‰ í›„ ê°„ë‹¨íˆ ì½˜ì†”ì— í‘œì‹œ
            try {
                const newsResp = await fetch(`/api/news/search?q=${encodeURIComponent(query)}`);
                const news = await newsResp.json();
                const wikiResp = await fetch(`/api/wiki/search?q=${encodeURIComponent(query)}`);
                const w = await wikiResp.json();
                console.log('í†µí•© ê²€ìƒ‰ ê²°ê³¼ - news:', news.length, 'wiki:', w.length);
            } catch (e) {
                console.error('í†µí•© ê²€ìƒ‰ ì˜¤ë¥˜:', e);
            }
        }

        function renderWikiResults(wikis) {
            const wikiGrid = document.getElementById('wikiGrid');
            if (!wikiGrid) return;
            wikiGrid.innerHTML = '';
            if (!wikis || wikis.length === 0) {
                wikiGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            wikis.forEach(item => {
                const el = document.createElement('div');
                el.className = 'wiki-card';
                el.onclick = () => location.href = `/wiki/${item.id}`;

                const categoryEl = document.createElement('div');
                categoryEl.className = 'wiki-category';
                categoryEl.textContent = item.category || '';

                const titleEl = document.createElement('h3');
                titleEl.className = 'wiki-title';
                titleEl.textContent = item.title;

                el.appendChild(categoryEl);
                el.appendChild(titleEl);

                const tagsHtml = (item.tags || '').split(',').filter(t => t).map(t => `<span style="display:inline-block;background:#eef2ff;color:#3730a3;padding:0.2rem 0.5rem;border-radius:8px;margin-right:6px;font-size:0.8rem;">#${t}</span>`).join('');
                if (tagsHtml) {
                    const tagsEl = document.createElement('div');
                    tagsEl.style.margin = '6px 0 0 0';
                    tagsEl.innerHTML = tagsHtml;
                    el.appendChild(tagsEl);
                }
                
                wikiGrid.appendChild(el);
            });
        }

        function createNewsElement(item) {
            const newsEl = document.createElement('div');
            newsEl.className = 'news-item';

            const metaEl = document.createElement('div');
            metaEl.className = 'news-meta';

            const metaDiv = document.createElement('div');
            const catLabel = CATEGORY_LABELS[item.category] || item.category || '';
            const catEmoji = CATEGORY_EMOJI[item.category] || '';
            
            const categorySpan = document.createElement('span');
            categorySpan.className = 'news-category';
            categorySpan.textContent = `${catEmoji} ${catLabel}`;

            const sourceSpan = document.createElement('span');
            sourceSpan.className = 'news-source';
            sourceSpan.textContent = item.source;

            metaDiv.appendChild(categorySpan);
            metaDiv.appendChild(sourceSpan);

            const dateSpan = document.createElement('span');
            dateSpan.textContent = item.date;

            metaEl.appendChild(metaDiv);
            metaEl.appendChild(dateSpan);

            const titleEl = document.createElement('h3');
            titleEl.className = 'news-title';

            const linkEl = document.createElement('a');
            linkEl.href = item.url;
            linkEl.target = '_blank';
            linkEl.textContent = item.title;

            titleEl.appendChild(linkEl);

            newsEl.appendChild(metaEl);
            newsEl.appendChild(titleEl);

            if (item.summary) {
                const summaryEl = document.createElement('p');
                summaryEl.className = 'news-summary';
                summaryEl.textContent = item.summary;
                newsEl.appendChild(summaryEl);
            }

            return newsEl;
        }

        async function searchNews() {
            const q = document.getElementById('newsSearch').value;
            const category = document.getElementById('newsCategory').value;
            
            try {
                const url = `/api/search?q=${encodeURIComponent(q)}&category=${encodeURIComponent(category)}`;
                const response = await fetch(url);
                const results = await response.json();
                const news = results.news;
                
                const newsGrid = document.getElementById('newsGrid');
                newsGrid.innerHTML = '';
                
                if (news.length === 0) {
                    newsGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                
                news.forEach(item => {
                    const newsEl = createNewsElement(item);
                    newsGrid.appendChild(newsEl);
                });
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            }
        }

        async function loadNews() {
            try {
                const response = await fetch('/api/news');
                const news = await response.json();
                
                document.getElementById('newsSearch').value = '';
                document.getElementById('newsCategory').value = '';
                
                const newsGrid = document.getElementById('newsGrid');
                newsGrid.innerHTML = '';
                
                news.forEach(item => {
                    const newsEl = createNewsElement(item);
                    newsGrid.appendChild(newsEl);
                });
            } catch (error) {
                console.error('ë‰´ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ìœ„í‚¤ ì „ì²´ ë¡œë“œ
        async function loadWiki() {
            try {
                const resp = await fetch('/api/wiki');
                const wikis = await resp.json();
                renderWikiResults(wikis);
            } catch (e) {
                console.error('ìœ„í‚¤ ë¡œë“œ ì˜¤ë¥˜:', e);
            }
        }

        // ìœ„í‚¤ ì¹´í…Œê³ ë¦¬ë³„ ë¡œë“œ
        async function loadWikiByCategory(category) {
            try {
                const url = `/api/wiki/search?category=${encodeURIComponent(category)}`;
                const resp = await fetch(url);
                const wikis = await resp.json();
                renderWikiResults(wikis);
            } catch (e) {
                console.error('ìœ„í‚¤ ì¹´í…Œê³ ë¦¬ í•„í„° ì˜¤ë¥˜:', e);
            }
        }

        async function runCrawler() {
            if (!confirm('í¬ë¡¤ë§ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch('/api/crawl', { method: 'POST' });
                const data = await response.json();
                alert(`í¬ë¡¤ë§ ì™„ë£Œ: ${data.count}ê°œì˜ ë‰´ìŠ¤ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                location.reload();
            } catch (error) {
                alert('í¬ë¡¤ë§ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // í¬ë¡¤ë§ ìƒíƒœ ë¡œë“œ
        async function loadCrawlStatus() {
            try {
                const response = await fetch('/api/crawl/status');
                const status = await response.json();
                
                const statusEl = document.getElementById('crawl-status');
                if (!status || !status.status) {
                    statusEl.innerHTML = '<p style="text-align: center; color: #999;">í¬ë¡¤ë§ ì‹¤í–‰ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                const statusColor = status.status === 'success' ? '#10b981' : 
                                   status.status === 'failed' ? '#ef4444' : '#f59e0b';
                const statusLabel = status.status === 'success' ? 'ì„±ê³µ' :
                                   status.status === 'failed' ? 'ì‹¤íŒ¨' : 'ì§„í–‰ì¤‘';
                
                statusEl.innerHTML = `
                    <div class="status-item">
                        <div class="status-badge" style="background-color: ${statusColor};">${statusLabel}</div>
                        <div class="status-info">
                            <p><strong>${status.count || 0}ê°œì˜ ë‰´ìŠ¤</strong> ìˆ˜ì§‘ë¨</p>
                            <p style="font-size: 0.9em; color: #666;">ì‹œì‘: ${new Date(status.started_at).toLocaleString()}</p>
                            ${status.completed_at ? `<p style="font-size: 0.9em; color: #666;">ì™„ë£Œ: ${new Date(status.completed_at).toLocaleString()}</p>` : ''}
                            ${status.message ? `<p style="font-size: 0.85em; color: #666; margin-top: 5px;">${status.message}</p>` : ''}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('í¬ë¡¤ë§ ìƒíƒœ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ ë¡œë“œ
        async function loadCrawlHistory() {
            try {
                const response = await fetch('/api/crawl/history?limit=5');
                const history = await response.json();
                
                const historyEl = document.getElementById('crawl-history');
                if (!history || history.length === 0) {
                    historyEl.innerHTML = '<p style="text-align: center; color: #999;">íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                historyEl.innerHTML = '';
                history.forEach(log => {
                    const statusColor = log.status === 'success' ? '#10b981' : 
                                       log.status === 'failed' ? '#ef4444' : '#f59e0b';
                    const statusLabel = log.status === 'success' ? 'ì„±ê³µ' :
                                       log.status === 'failed' ? 'ì‹¤íŒ¨' : 'ì§„í–‰ì¤‘';
                    
                    const el = document.createElement('div');
                    el.className = 'history-item';
                    el.innerHTML = `
                        <div class="history-time">${new Date(log.started_at).toLocaleString()}</div>
                        <div class="history-content">
                            <span class="history-badge" style="background-color: ${statusColor};">${statusLabel}</span>
                            <span class="history-count">${log.count || 0}ê°œ</span>
                        </div>
                    `;
                    historyEl.appendChild(el);
                });
            } catch (error) {
                console.error('í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ë¡œë“œ
        async function loadCategoryStats() {
            try {
                const response = await fetch('/api/stats/categories');
                const stats = await response.json();
                
                const statsEl = document.getElementById('category-stats');
                if (!stats || stats.length === 0) {
                    statsEl.innerHTML = '<p style="text-align: center; color: #999;">í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                statsEl.innerHTML = '';
                stats.forEach(stat => {
                    const el = document.createElement('div');
                    el.className = 'source-stat-item';
                    el.innerHTML = `
                        <span class="source-name">${stat.label}</span>
                        <span class="source-count">${stat.count}</span>
                    `;
                    statsEl.appendChild(el);
                });
            } catch (error) {
                console.error('ì¹´í…Œê³ ë¦¬ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        window.addEventListener('load', () => {
            if (currentSection === 'dashboard') {
                loadSourceStats();
                loadCategoryStats();
            }
        });

        // ì†ŒìŠ¤ë³„ í†µê³„ ë¡œë“œ
        async function loadSourceStats() {
            try {
                const response = await fetch('/api/stats/sources');
                const stats = await response.json();
                
                const statsEl = document.getElementById('source-stats');
                if (!stats || stats.length === 0) {
                    statsEl.innerHTML = '<p style="text-align: center; color: #999;">í†µê³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                statsEl.innerHTML = '';
                stats.forEach(stat => {
                    const el = document.createElement('div');
                    el.className = 'source-stat-item';
                    el.innerHTML = `
                        <span class="source-name">${stat.source}</span>
                        <span class="source-count">${stat.count}</span>
                    `;
                    statsEl.appendChild(el);
                });
            } catch (error) {
                console.error('ì†ŒìŠ¤ í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì„¹ì…˜ ì „í™˜ ì‹œ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        function switchSection(section) {
            document.getElementById('news-section').style.display = 'none';
            document.getElementById('wiki-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById(section + '-section').style.display = 'block';
            currentSection = section;
            
            if (section === 'dashboard') {
                loadSourceStats();
                loadCategoryStats();
            }
        }
    </script>
</body>
</html>