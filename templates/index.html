<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì•ˆ ë‰´ìŠ¤ í¬ë¡¤ë§ & ì§€ì‹ ê³µìœ  í”Œë«í¼</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}?v=1.1">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='favicon.ico') }}">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">ğŸ”’ ë³´ì•ˆ ë‰´ìŠ¤ í”Œë«í¼</div>
            <nav>
                <ul class="nav-menu" id="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="news">ë‰´ìŠ¤</a></li>
                    <li><a href="#" class="nav-link" data-section="wiki">ì§€ì‹ ì‚¬ì „</a></li>
                    <li><a href="#" class="nav-link" data-section="dashboard">ëŒ€ì‹œë³´ë“œ</a></li>
                    <li><a href="/wiki/manage" class="nav-link">ğŸ“ ìœ„í‚¤ ê´€ë¦¬</a></li>
                    <li><a href="/sources/manage" class="nav-link">ğŸ”— ì†ŒìŠ¤ ê´€ë¦¬</a></li>
                </ul>
            </nav>
            <button class="nav-toggle" id="nav-toggle" aria-label="ë©”ë‰´ í† ê¸€">
                <span class="hamburger"></span>
            </button>
        </div>
    </header>

    <div class="main-container">
        <main class="content-area">
            <div id="news-section" class="news-content active">
                <div class="section-header">
                    <h1 class="section-title">ìµœì‹  ë³´ì•ˆ ë‰´ìŠ¤</h1>
                    <button class="btn btn-secondary crawl-btn" onclick="runCrawler()">ğŸ”„ í¬ë¡¤ë§</button>
                </div>
                
                <div class="filter-controls">
                    <div class="search-filter-grid">
                        <input type="text" id="newsSearch" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰..." class="search-input" onkeyup="filterNews()">
                        <select id="newsCategory" class="search-input" onchange="fetchNews()">
                            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                            <option value="trend">íŠ¸ë Œë“œ</option>
                            <option value="malware">ì•…ì„±ì½”ë“œ</option>
                            <option value="vulnerability">ì·¨ì•½ì </option>
                            <option value="network">ë„¤íŠ¸ì›Œí¬</option>
                            <option value="web">ì›¹ ë³´ì•ˆ</option>
                            <option value="crypto">ì•”í˜¸í•™</option>
                        </select>
                        <button class="btn" onclick="loadNews()">ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <div class="pagination-wrapper">
                    <div class="d-flex justify-content-end align-items-center" style="margin-bottom: 0.5rem;">
                        <div class="page-info-total">
                            ì´ <strong id="totalItems">{{ pagination.total_items }}</strong>ê°œ
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center" style="gap: 0.5rem;">
                            <label for="pageSize" style="margin: 0;">í•­ëª© ìˆ˜:</label>
                            <select id="pageSize" onchange="changeLimit(this.value)" class="form-select" style="width: auto;">
                                <option value="10" {% if pagination.limit == 10 %}selected{% endif %}>10</option>
                                <option value="20" {% if pagination.limit == 20 %}selected{% endif %}>20</option>
                                <option value="50" {% if pagination.limit == 50 %}selected{% endif %}>50</option>
                                <option value="100" {% if pagination.limit == 100 %}selected{% endif %}>100</option>
                            </select>
                        </div>
                        <nav id="pagination-nav"></nav>
                    </div>
                </div>
                
                {% set category_labels = {'malware':'ì•…ì„±ì½”ë“œ','vulnerability':'ì·¨ì•½ì ','network':'ë„¤íŠ¸ì›Œí¬','web':'ì›¹ ë³´ì•ˆ','crypto':'ì•”í˜¸í•™','trend':'ê¸°íƒ€'} %}
                <div class="news-grid" id="newsGrid">
                    {% for news in news_list %}
                    <div class="news-item" data-category="{{ news.category or '' }}">
                        <div class="news-meta">
                            <div class="news-meta-start">
                                <span class="badge badge-category">{{ category_labels.get(news.category, news.category) }}</span>
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <span class="badge badge-source-kr">ğŸ‡°ğŸ‡· {{ news.source }}</span>
                                {% else %}
                                <span class="badge badge-source-en">ğŸŒ {{ news.source }}</span>
                                {% endif %}
                            </div>
                            <span>{{ news.date }}</span>
                        </div>
                        <h3 class="news-title">
                            <a href="{{ news.url }}" target="_blank">{{ news.title }}</a>
                        </h3>
                        {% if news.summary %}
                        <p class="news-summary">{{ news.summary | clean_summary }}</p>
                        {% endif %}
                        <div class="news-footer">
                            <div>
                                ğŸ“° ì¶œì²˜: 
                                {% if 'ë³´ì•ˆë‰´ìŠ¤' in news.source %}
                                <a href="https://www.boannews.com" target="_blank">www.boannews.com</a>
                                {% elif 'HackRead' in news.source %}
                                <a href="https://www.hackread.com" target="_blank">www.hackread.com</a>
                                {% else %}
                                <span>{{ news.source }}</span>
                                {% endif %}
                            </div>
                            <button class="btn btn-danger" onclick="deleteNews('{{ news.id }}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="wiki-section" class="wiki-content">
                <div class="section-header">
                    <h1 class="section-title">ë³´ì•ˆ ì§€ì‹ ì‚¬ì „</h1>
                </div>
                <div id="wikiGrid" class="wiki-grid">
                    {% for wiki in wiki_list %}
                    <div class="wiki-card">
                        <div class="wiki-header">
                            <div class="badge badge-category">{{ wiki.category }}</div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                {% if wiki.type == 'auto' %}
                                <span class="badge badge-wiki-auto">ğŸ¤– ìë™ìˆ˜ì§‘</span>
                                {% elif wiki.type == 'manual' %}
                                <span class="badge badge-wiki-manual">âœï¸ ìˆ˜ë™ì‘ì„±</span>
                                {% else %}
                                <span class="badge badge-wiki-expert">ğŸ“š ì „ë¬¸ë¬¸ì„œ</span>
                                {% endif %}
                                <button class="btn btn-danger"
                                    style="padding: 2px 8px; font-size: 0.75rem; line-height: 1.4;"
                                    onclick="event.stopPropagation(); deleteWiki('{{ wiki.id }}', this.closest('.wiki-card'))">ì‚­ì œ</button>
                            </div>
                        </div>
                        <div onclick="location.href='/wiki/{{ wiki.id }}'">
                            <h3 class="wiki-title">{{ wiki.title }}</h3>
                            <p class="wiki-preview">{{ wiki | wiki_preview('medium') }}</p>
                            {% if wiki.tags %}
                            <div class="wiki-tags">
                                {% for t in (wiki.tags.split(',') if wiki.tags else []) %}
                                <span class="tag">#{{ t }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="dashboard-section" class="dashboard-content">
                <div class="section-header">
                    <h1 class="section-title">ëŒ€ì‹œë³´ë“œ</h1>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.news_count }}</div>
                        <div class="stat-label">ìˆ˜ì§‘ëœ ë‰´ìŠ¤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ stats.wiki_count }}</div>
                        <div class="stat-label">ì§€ì‹ ë¬¸ì„œ</div>
                    </div>
                </div>

                <div class="dashboard-section-title">í¬ë¡¤ë§ ì†ŒìŠ¤</div>
                <div class="crawl-sources">
                    <div class="source-card">
                        <h4>ğŸ‡°ğŸ‡· êµ­ë‚´ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>ë³´ì•ˆë‰´ìŠ¤</strong> - www.boannews.com<br>
                                <small>êµ­ë‚´ ìµœëŒ€ ì •ë³´ë³´ì•ˆ ì „ë¬¸ ë¯¸ë””ì–´</small>
                            </li>
                        </ul>
                    </div>
                    <div class="source-card">
                        <h4>ğŸŒ í•´ì™¸ ì†ŒìŠ¤ (1ê°œ)</h4>
                        <ul>
                            <li><strong>HackRead</strong> - hackread.com<br>
                                <small>ì‚¬ì´ë²„ ë³´ì•ˆ ë‰´ìŠ¤ ë° í•´í‚¹ ê´€ë ¨ ì •ë³´</small>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="info-box">
                    <p>
                        <strong>â„¹ï¸ í¬ë¡¤ë§ ì†ŒìŠ¤ ì •ë³´</strong><br>
                        ìœ„ëŠ” ê¸°ë³¸ ë‚´ì¥ ì†ŒìŠ¤ì…ë‹ˆë‹¤. <a href="/sources/manage">ğŸ”— ì†ŒìŠ¤ ê´€ë¦¬</a> í˜ì´ì§€ì—ì„œ ì¶”ê°€ ì†ŒìŠ¤ë¥¼ ë“±ë¡í•˜ì—¬ ë” ë§ì€ ë‰´ìŠ¤ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        ë§¤ì¼ ìë™ í¬ë¡¤ë§ ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ "í¬ë¡¤ë§" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë‰´ìŠ¤ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <div class="dashboard-section-title">ì†ŒìŠ¤ë³„ ë‰´ìŠ¤ ìˆ˜</div>
                <div id="source-stats" class="source-stats card">
                    <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                </div>

                <div class="dashboard-section-title">ì¹´í…Œê³ ë¦¬ë³„ í†µê³„</div>
                <div id="category-stats" class="category-stats-grid">
                    <div class="stats-loading">ë¡œë“œ ì¤‘...</div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="card sidebar-card">
                <input type="text" class="search-input" placeholder="ë‰´ìŠ¤ ë° ì§€ì‹ ê²€ìƒ‰..." onkeyup="searchContent(this.value)">
            </div>
            <div class="card sidebar-card">
                <h3>ì¹´í…Œê³ ë¦¬</h3>
                <ul class="category-list">
                    <li onclick="filterByCategory('network')">ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('web')">ğŸ’» ì›¹ ë³´ì•ˆ</li>
                    <li onclick="filterByCategory('crypto')">ğŸ” ì•”í˜¸í•™</li>
                    <li onclick="filterByCategory('malware')">ğŸ¦  ì•…ì„±ì½”ë“œ</li>
                    <li onclick="filterByCategory('trend')">ğŸ“ˆ ìµœì‹  íŠ¸ë Œë“œ</li>
                </ul>
            </div>
        </aside>
    </div>

    <script src="{{ url_for('static', path='js/main.js') }}"></script>
    <script>
        // ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ í† ê¸€ ê¸°ëŠ¥ (main.js ëŒ€ì²´)
        document.addEventListener('DOMContentLoaded', () => {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
        });

        // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì´ˆê¸° í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì„¤ì •
        var currentPage = JSON.parse('{{ pagination.page | default(1) | tojson | safe }}');
        var totalPages = JSON.parse('{{ pagination.total_pages | default(1) | tojson | safe }}');
        var currentLimit = JSON.parse('{{ pagination.limit | default(10) | tojson | safe }}');

        function deleteWiki(wikiId, cardElement) {
            if (!confirm('ì •ë§ë¡œ ì´ ìœ„í‚¤ ë¬¸ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            fetch(`/api/wiki/${wikiId}/delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… ìœ„í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜ ì¹´ë“œ ì œê±°
                    if (cardElement) {
                        cardElement.style.transition = 'opacity 0.5s, transform 0.5s';
                        cardElement.style.opacity = '0';
                        cardElement.style.transform = 'scale(0.9)';
                        setTimeout(() => cardElement.remove(), 500);
                    }
                } else {
                    alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // --- í˜ì´ì§€ë„¤ì´ì…˜ ë° í•„í„°ë§ ë¡œì§ (API í˜¸ì¶œ ì—†ì´ í˜ì´ì§€ ì´ë™ ë°©ì‹) ---

        // Initial render
        document.addEventListener('DOMContentLoaded', function() {
            renderPagination(totalPages, currentPage);
        });
    </script>
</body>
</html>